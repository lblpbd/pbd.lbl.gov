function reloadWithQueryStringVars(e){var t=location.search?location.search.substring(1).split("&"):[],n=location.search?location.href.replace(location.search,""):location.href,r={},i=n+"?";if(t.length>0)for(var s=0;s<t.length;s++){var o=t[s].split("=");r[o[0]]=o[1]}if(e)for(var u in e)r[u]=e[u];if(r){for(var a in r)i+=a+"="+r[a]+"&";i=i.substring(0,i.length-1);window.location.href=i}else window.location.href=location.href}jQuery(document).ready(function(e){function t(t){var n=jQuery(".style-mp-page").length,r=n+1,i='<li class="style-mp-page" title="'+r+'" id="ninja_forms_style_mp_page_'+r+'">'+r+"</li>";e("#style-mp-page-list").append(i);var i='<div id="ninja_forms_style_mp_'+r+'" class="style-layout"><div>Columns: <select name="cols_'+r+'" id="cols_'+r+'" class="ninja-forms-style-col"><option value="1" selected>1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div><input type="hidden" name="order_'+r+'" id="order_'+r+'" value="" class="field-order"><div id="col_fields_'+r+'"></div><ul class="sortable ninja-forms-style-sortable cols-1" rel="1" id="ninja_forms_style_list_'+r+'"><li class="ui-disabled" style="display: none;" id="ninja_forms_field_'+t.new_id+'_li"></li></ul>';e("#ninja-forms-slide").append(i);e(".ninja-forms-style-sortable").sortable({items:"li:not(.ui-state-disabled)",tolerance:"intersect",cursor:"move",placeholder:"ninja-forms-style-placeholder",forcePlaceholderSize:!0,opacity:.4,handle:".style-handle",connectWith:".ninja-forms-style-sortable",start:function(e,t){t.placeholder.height(t.item.height());t.placeholder.width(t.item.width())}});e(".style-mp-page").droppable({accept:".ninja-forms-style-sortable li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(t,n){e(".spinner").show();var r=this.title;n.draggable.hide("slow",function(){var t=e("#cols_"+r).val();e(this).appendTo("#ninja_forms_style_list_"+r);e(this).attr("style","");if(e(this).attr("rel")>t){e(this).removeClass("span-"+e(this).attr("rel"));e(this).addClass("span-"+t);e(this).attr("rel",t);var n=e(this).prop("id").replace("_li","_colspan");e("#"+n).val(t)}e(this).show("slow");e(".spinner").hide()})}});e(".spinner").hide()}function n(t){var n="",r="",i="",s="",o=(t-1)*450,u=e("#cols_"+t).val();e("#col_fields_"+t).prop("innerHTML","");for(var a=u;a>=1;a--){var f='<input type="hidden" name="col_'+a+"_"+t+'" id="col_'+a+"_"+t+'" value="">';e("#col_fields_"+t).append(f)}e("#ninja_forms_style_list_"+t+" li").each(function(){var t=e(this).position(),u=this.id.replace("ninja_forms_field_","");u=u.replace("_li","");var a=t.left;a=parseInt(a);col_1_left=0+o;col_2_left=125+o;col_3_left=225+o;if(a<=col_1_left||a==0)n==""?n=u:n=n+","+u;a>col_1_left&&a<col_2_left&&(r==""?r=u:r=r+","+u);a>col_2_left&&a<col_3_left&&(i==""?i=u:i=i+","+u);a>col_3_left&&(s==""?s=u:s=s+","+u)});e("#col_1_"+t).val(n);e("#col_2_"+t).val(r);e("#col_3_"+t).val(i);e("#col_4_"+t).val(s);var l=e("#ninja_forms_style_list_"+t).sortable("toArray");e("#order_"+t).val(l)}function r(){var t="",n="",r="",i="";e(".ninja-forms-style-sortable li").each(function(){var s=e(this).position(),o=this.id.replace("ninja_forms_field_","");o=o.replace("_li","");var u=s.left;u=parseInt(u);u==0&&(t==""?t=o:t=t+","+o);u>0&&u<150&&(n==""?n=o:n=n+","+o);u>150&&u<250&&(r==""?r=o:r=r+","+o);u>250&&(i==""?i=o:i=i+","+o)});e("#col_1").val(t);e("#col_2").val(n);e("#col_3").val(r);e("#col_4").val(i);var s=e(".ninja-forms-style-sortable").sortable("toArray");e("#order").val(s)}e(document).on("change","#advanced_css",function(){this.checked?e("tr.advanced").removeClass("hidden"):e("tr.advanced").addClass("hidden")});e(".color-picker").wpColorPicker();e("#field_type").change(function(){var t=e("#field_type").val();reloadWithQueryStringVars({field_type:t})});e("body").on("click",".field-styling",function(t){var n=this.id.replace("styling_","");e("#ninja_forms_field_styling").prop("innerHTML","");e("#loading_style").show();e.post(ajaxurl,{field_id:n,action:"ninja_forms_style_field_styling"},function(t){e("#loading_style").hide();e("#ninja_forms_field_styling").append(t);e(".color-picker").wpColorPicker();e(".hndle").dblclick(function(t){e(this).prevAll(".item-controls:first").find("a").click()})})});e(".save-field-styling").click(function(){var t=e("#ninja_forms_field_styling").find(":input").serializeFullArray();e("#loading_style").show();e.post(ajaxurl,{data:t,action:"ninja_forms_style_field_styling_save"},function(t){tb_remove();e("#ninja_forms_field_styling").prop("innerHTML","");e("#loading_style").hide()})});e(".cancel-field-styling").click(function(){tb_remove();e("#ninja_forms_field_styling").prop("innerHTML","")});e(".cancel-form-styling").click(function(){tb_remove()});e(".save-form-styling").click(function(){var t=e("#ninja_forms_form_style_inputs").find(":input").serializeFullArray();e("#loading_style").show();e.post(ajaxurl,{data:t,action:"ninja_forms_style_form_styling_save"},function(t){tb_remove();e("#loading_style").hide()})});e(".ninja-forms-style-sortable").sortable({items:"li:not(.ui-state-disabled)",tolerance:"intersect",cursor:"move",placeholder:"ninja-forms-style-placeholder",forcePlaceholderSize:!0,opacity:.4,handle:".style-handle",connectWith:".ninja-forms-style-sortable",start:function(e,t){t.placeholder.height(t.item.height());t.placeholder.width(t.item.width())}});e(".ninja-forms-style-sortable").disableSelection();e("#ninja_forms_admin").submit(function(){e("#mp_form").val()=="1"?e(".field-order").each(function(){var e=this.id.replace("order_","");n(e)}):r()});e(document).on("click",".ninja-forms-style-expand",function(t){t.preventDefault();if(e("#mp_form").val()=="1")var n=e("#mp_page").val(),r=e("#cols_"+n).val();else var r=e("#cols").val();var i=e(this).parent().prop("id").replace("_li","_colspan"),s=e(this).parent().attr("rel");r=parseInt(r);s=parseInt(s);if(s==r)var o=1;else var o=s+1;e(this).parent().removeClass("span-"+s);e(this).parent().addClass("span-"+o);e(this).parent().attr("rel",o);e("#"+i).val(o)});e("#cols").change(function(){var t=e(".ninja-forms-style-sortable").attr("rel"),n=this.value;n=parseInt(n);e(".ninja-forms-style-sortable").removeClass("cols-"+t);e(".ninja-forms-style-sortable").addClass("cols-"+n);e(".ninja-forms-style-sortable").attr("rel",n);e(".ninja-forms-style-sortable li").each(function(){if(e(this).attr("rel")>n){var t=e(this).attr("rel");e(this).removeClass("span-"+t);e(this).addClass("span-"+n);e(this).attr("rel",n);var r=e(this).prop("id").replace("_li","_colspan");e("#"+r).val(n)}});e("#col_fields").prop("innerHTML","");for(var r=n;r>=1;r--){var i='<input type="hidden" name="col_'+r+'" id="col_'+r+'" value="">';e("#col_fields").append(i)}});e(document).on("click",".style-mp-page",function(t){t.preventDefault();var n=this.title,r=jQuery("#ninja_forms_style_mp_"+n).position().left;if(jQuery("#ninja-forms-slide").position().left!=-r){jQuery("#ninja-forms-slide").animate({left:-r},"300");e(".style-mp-page").removeClass("active");e(this).addClass("active");e("#mp_page").val(n)}});e(".style-mp-add").droppable({accept:".ninja-forms-style-sortable li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(n,r){var i="_page_divider",s=e("#_form_id").val();e(".spinner").show();e.post(ajaxurl,{type:i,form_id:s,action:"ninja_forms_new_field"},function(n){t(n);var i=jQuery(".style-mp-page").length;r.draggable.hide("slow",function(){var t=e("#cols_"+i).val();e(this).appendTo("#ninja_forms_style_list_"+i);e(this).attr("style","");if(e(this).attr("rel")>t){e(this).removeClass("span-"+e(this).attr("rel"));e(this).addClass("span-"+t);e(this).attr("rel",t);var n=e(this).prop("id").replace("_li","_colspan");e("#"+n).val(t)}e(this).show("slow");var r=jQuery("#ninja_forms_style_mp_"+i).position().left;if(jQuery("#ninja-forms-slide").position().left!=-r){jQuery("#ninja-forms-slide").animate({left:-r},"300");e(".style-mp-page").removeClass("active");e("#ninja_forms_style_mp_page_"+i).addClass("active");e("#mp_page").val(i)}e(".spinner").hide()})})}});e(".style-mp-add").click(function(){var n="_page_divider",r=e("#_form_id").val();e(".spinner").show();e.post(ajaxurl,{type:n,form_id:r,action:"ninja_forms_new_field"},function(e){t(e)})});e(".style-mp-subtract").click(function(){var t=confirm("Really delete this page? All fields will be removed.");if(t){var n=e("#_form_id").val(),r=e(".style-mp-page.active").attr("title"),i=e(".style-mp-page").length,s=e("#ninja_forms_style_list_"+r).sortable("toArray");if(s!=""){e(".spinner").show();e.post(ajaxurl,{form_id:n,fields:s,action:"ninja_forms_mp_delete_page"},function(t){if(i==1)for(var n=s.length-1;n>=0;n--)e("#"+s[n]).remove();else{r>1?move_to_page=r-1:move_to_page=1;e("#ninja_forms_style_list_"+r).remove();e("#ninja_forms_style_mp_page_"+r).remove();e("#ninja_forms_style_mp_"+r).remove();var n=1;e(".style-mp-page").each(function(){e(this).prop("id","ninja_forms_style_mp_page_"+n);e(this).prop("innerHTML",n);e(this).attr("title",n);n++});var n=1;e(".ninja-forms-style-sortable").each(function(){e(this).prop("id","ninja_forms_style_list_"+n);n++});var n=1;e(".style-layout").each(function(){e(this).prop("id","ninja_forms_style_mp_"+n);n++});if(move_to_page!=1){var o=jQuery("#ninja_forms_style_mp_"+move_to_page).position().left;jQuery("#ninja-forms-slide").position().left!=-o&&jQuery("#ninja-forms-slide").animate({left:-o},"300")}e(".style-mp-page").removeClass("active");e("#ninja_forms_style_mp_page_"+move_to_page).addClass("active");e("#mp_page").val(move_to_page);e(".spinner").hide();var o=jQuery("#ninja_forms_style_mp_"+move_to_page).position().left;if(jQuery("#ninja-forms-slide").position().left!=-o){jQuery("#ninja-forms-slide").animate({left:-o},"300");e(".style-mp-page").removeClass("active");e("#ninja_forms_style_mp_page_"+move_to_page).addClass("active");e("#mp_page").val(move_to_page)}}})}}});e(".ninja-forms-style-col").change(function(){var t=this.id.replace("cols_",""),r=this.value,i=e("#ninja_forms_style_list_"+t).attr("rel");e("#ninja_forms_style_list_"+t).removeClass("cols-"+i);e("#ninja_forms_style_list_"+t).addClass("cols-"+r);e("#ninja_forms_style_list_"+t).attr("rel",r);e("#ninja_forms_style_list_"+t+" li").each(function(){if(e(this).attr("rel")>r){var t=e(this).attr("rel");e(this).removeClass("span-"+t);e(this).addClass("span-"+r);e(this).attr("rel",r);var n=e(this).prop("id").replace("_li","_colspan");e("#"+n).val(r)}});n(t)});e(".style-mp-page").droppable({accept:".ninja-forms-style-sortable li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(t,n){e(".spinner").show();var r=this.title;n.draggable.hide("slow",function(){var t=e("#cols_"+r).val();e(this).appendTo("#ninja_forms_style_list_"+r);e(this).attr("style","");if(e(this).attr("rel")>t){e(this).removeClass("span-"+e(this).attr("rel"));e(this).addClass("span-"+t);e(this).attr("rel",t);var n=e(this).prop("id").replace("_li","_colspan");e("#"+n).val(t)}e(this).show("slow");e(".spinner").hide()})}})});